<!doctype html>
<html>
  <head>
    <title>add-card demo</title>
    <script src="/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <link rel="import" href="/bower_components/iron-location/iron-location.html">
    <link rel="import" href="/bower_components/card-display/card-display.html">
    <link rel="import" href="/bower_components/iron-localstorage/iron-localstorage.html">
    <link rel="import" href="/bower_components/polymer/polymer.html">
  </head>
  <body>
    <add-card></add-card>
  </body>
</html>


<!--
`<add-card></add-card>` 
@demo demo.html
-->

<dom-module id="add-card">
  <template>
    <iron-location hash="{{a}}"></iron-location>
    <card-display id="cardDisplay" on-picked="add"  pickable cards="{{cards}}"></card-display>
    <iron-localstorage name="addme" value="{{addme}}"></iron-localstorage>
  </template>
</dom-module>
<script>
Polymer({
  is: "add-card",
  properties: {
    data: {computed: "decode(a)"},
    cards: {computed: "getOptions(data)"}
  },
  decode: function(a) {
    return JSON.parse(decodeURIComponent(a))
  },
  getOptions: function(data) {
    var output = []
    var title = data.title
    var tpl = '<div title="{{Desc}}" style="float:left;background-size: contain;background-position: center;display:inline-block;width:32px;height:32px; background-image:url({{_fav}});background-repeat:no-repeat"></div><h3  title="{{Desc}}" style="margin:0px;padding:10px;font-size: 15px;">{{title}}</h3><img title="{{Desc}}" style="width:167px;left:0;bottom:0;position:absolute" src="{{_image}}" />'
    var defaultArtical = "data:image/svg+xml;charset=UTF-8,&lt;svg viewBox=&quot;0 0 24 24&quot; preserveAspectRatio=&quot;xMidYMid meet&quot; class=&quot;style-scope iron-icon&quot; style=&quot;pointer-events: none; display: block; width: 100%; height: 100%;&quot;&gt;&lt;g class=&quot;style-scope iron-icon&quot;&gt;&lt;path d=&quot;M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z&quot; class=&quot;style-scope iron-icon&quot;&gt;&lt;\/path&gt;&lt;\/g&gt;&lt;\/svg&gt;"
    var defaultHome = "data:image/svg+xml;charset=UTF-8,&lt;svg viewBox=&quot;0 0 24 24&quot; preserveAspectRatio=&quot;xMidYMid meet&quot; class=&quot;style-scope iron-icon&quot; style=&quot;pointer-events: none; display: block; width: 100%; height: 100%;&quot;&gt;&lt;g class=&quot;style-scope iron-icon&quot;&gt;&lt;path d=&quot;M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z&quot; class=&quot;style-scope iron-icon&quot;&gt;&lt;\/path&gt;&lt;\/g&gt;&lt;\/svg&gt;"
    if (!data.image) {
      if (data.url.split('/').length < 5) { //home
        data.image = defaultHome
      } else {
        data.image = defaultArtical
      }
    }
    if (data.title !== title.split(" | ")[0]) {
      output.push({title: title.split(" | ")[0], url:data.url, _image:data.image, _fav:data.fav, _data:tpl, Desc:data.desc})
      output.push({title: title.split(" | ")[1], url:data.url, _image:data.image, _fav:data.fav, _data:tpl, Desc:data.desc})
      if ( ((title.split(" | ")[1].length - 12)*(title.split(" | ")[1].length - 12)) < ((title.split(" | ")[0].length - 12)*(title.split(" | ")[0].length - 12)) ) {
        title = data.title.split(" | ")[1]
      } else {
        title = data.title.split(" | ")[0]
      }
    } else if (title !== title.split(" - ")[0]) {
      output.push({title: data.title.split(" - ")[0], url:data.url, _image:data.image, _fav:data.fav, _data:tpl, Desc:data.desc})
      output.push({title: data.title.split(" - ")[1], url:data.url, _image:data.image, _fav:data.fav, _data:tpl, Desc:data.desc})
      if ( ((title.split(" - ")[1].length - 12)*(title.split(" - ")[1].length - 12)) < ((title.split(" - ")[0].length - 12)*(title.split(" - ")[0].length - 12)) ) {
        title = data.title.split(" - ")[1]
      } else {
        title = data.title.split(" - ")[0]
      }
    } else {
      output.push({title: title, url:data.url, _image:data.image, _fav:data.fav, _data:tpl, Desc:data.desc})
    }
    if (data.alt)
    for (var i = 0;i < data.alt.length; i++) {
      output.push({title: title, url:data.url, _image:data.alt[i], _fav:data.fav, _data:tpl, Desc:data.desc})
    }
    return output
  },
  hash: function(it) {
    return this.$.cardDisplay.hash(it)
  },
  add: function(e) {
    if (!this.addme) {
      this.addme = {}
    }
    var hash = this.hash(this.cards[e.detail].url)
    this.set("addme." + hash, this.cards[e.detail])
    setTimeout(function(){ window.location.href = '/' }, 100)
  }
})
</script>
